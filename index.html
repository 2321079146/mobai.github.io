<html>
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Gridea</title>
<link rel="shortcut icon" href="https://2321079146.github.io/mobai.github.io//favicon.ico?v=1643334270097">
<link href="https://cdn.jsdelivr.net/npm/remixicon@2.3.0/fonts/remixicon.css" rel="stylesheet">
<link rel="stylesheet" href="https://2321079146.github.io/mobai.github.io//styles/main.css">
<link rel="alternate" type="application/atom+xml" title="Gridea - Atom Feed" href="https://2321079146.github.io/mobai.github.io//atom.xml">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700">



    <meta name="description" content="温故而知新" />
  </head>
  <body>
    <div class="main">
      <div class="main-content">
        <div class="site-header">
  <a href="https://2321079146.github.io/mobai.github.io/">
  <img class="avatar" src="https://2321079146.github.io/mobai.github.io//images/avatar.png?v=1643334270097" alt="">
  </a>
  <h1 class="site-title">
    Gridea
  </h1>
  <p class="site-description">
    温故而知新
  </p>
  <div class="menu-container">
    
      
        <a href="https://2321079146.github.io/mobai.github.io/" class="menu">
          首页
        </a>
      
    
      
        <a href="https://2321079146.github.io/mobai.github.io/archives" class="menu">
          归档
        </a>
      
    
      
        <a href="https://2321079146.github.io/mobai.github.io/tags" class="menu" target="_blank">
          标签
        </a>
      
    
      
        <a href="https://2321079146.github.io/mobai.github.io/post/about" class="menu">
          关于
        </a>
      
    
  </div>
  <div class="social-container">
    
      
    
      
    
      
    
      
    
      
    
  </div>
</div>

    
        <div class="post-container">
  
    <article class="post">
      <a href="https://2321079146.github.io/mobai.github.io/post/barcode4j-sheng-cheng-tiao-xing-ma-zxing-sheng-cheng-er-wei-ma-zxing-shi-bie-itextpdf-zeng-jia-zhi-pdf-zhong/">
        <h2 class="post-title">barcode4j生成条形码，zxing生成二维码，zxing识别，itextpdf增加至pdf中</h2>
      </a>
      <div class="post-info">
        <span>
          2022-01-28
        </span>
        <span>
          9 min read
        </span>
        
      </div>
      
      <div class="post-abstract">
        
      </div>
    </article>
  
    <article class="post">
      <a href="https://2321079146.github.io/mobai.github.io/post/spire-chuang-jian-code128a-he-tiao-xing-ma/">
        <h2 class="post-title">Spire创建code128A和条形码</h2>
      </a>
      <div class="post-info">
        <span>
          2022-01-28
        </span>
        <span>
          4 min read
        </span>
        
          <a href="https://2321079146.github.io/mobai.github.io/tag/QPCYPv9Bn/" class="post-tag">
            # 二维码、条形码
          </a>
        
      </div>
      
      <div class="post-abstract">
        <pre><code class="language-java">    /**
     * 创建二维码
     *
     * @param sku         sku名称
     * @param skuFilePath 文件保存地址
     * @param type        二维码类型
     * @return 文件保存路径
     */
    public static String createPdf(String sku, String skuFilePath, int type) {
        if (StringUtils.isBlank(sku)) {
            return null;
        }

        int pdfWidth, pdfHeight;
        float qrWidth;
        double barcodeWidth, barcodeHeight;
        int fontsize;
        float leftMargin, topMargin;

        if (type == OsjConstant.BARCODE_COMMON) {// 普通版本
            pdfWidth = 308;
            pdfHeight = 105;
            qrWidth = 93;
            barcodeWidth = 190;
            barcodeHeight = 65;
            fontsize = 26;
            leftMargin = 6;
            topMargin = 6;
        } else if (type == OsjConstant.BARCODE_BIG_WIDTH) {// 大边距普通版本
            // pdf页面宽度
            pdfWidth = 328;
            // PDF页面高度
            pdfHeight = 125;
            // 二维码尺寸
            qrWidth = 90;
            // 条形码宽度
            barcodeWidth = 180;
            // 条形码高度
            barcodeHeight = 65;
            // 条形码下面的字的尺寸
            fontsize = 15;
            // 条形码离左侧的距离
            leftMargin = 16;
            // 条形码离上面的距离
            topMargin = 16;
        } else {// 条码宽版本
            pdfWidth = 328;
            pdfHeight = 105;
            qrWidth = 93;
            barcodeWidth = 210;
            barcodeHeight = 62;
            fontsize = 29;
            leftMargin = 6;
            topMargin = 6;
        }

        //创建PdfDocument对象
        PdfDocument doc = new PdfDocument();
        Dimension2D pdfSize = new Dimension(pdfWidth, pdfHeight);
        PdfMargins margins = new PdfMargins(leftMargin, topMargin);
        //添加一页
        PdfPageBase page = doc.getPages().add(pdfSize, margins);
        page.setBackgroudOpacity(0);
        //初始化y变量
        double y = 0;

        // 配件sku需增加字符串显示
        final String partsStr = &quot;PJ&quot;;
        if (sku.startsWith(partsStr)) {
            y = 35;
            barcodeHeight = 30;
            Point2D.Float pointPJ = new Point2D.Float();
            pointPJ.setLocation(50,1);
            page.getCanvas().drawString(&quot;** PARTS **&quot;, new PdfTrueTypeFont(new Font(&quot;Arial&quot;, Font.BOLD, fontsize), true),
                    new PdfSolidBrush(new PdfRGBColor(Color.black)), pointPJ);
        }

        Point2D.Float point = new Point2D.Float();
        point.setLocation(0, y);

        // 绘制Code128A条码到PDF
        BarcodeSettings settingsCode = new BarcodeSettings();
        // 设置条形码类型
        settingsCode.setType(BarCodeType.Code_128);
        // code128a
        settingsCode.setCode128SetMode(Code128SetMode.Only_A);
        // 设置条形码数据
        settingsCode.setData(sku);
        // 不显示文本
        settingsCode.setShowText(false);
        //在底部显示数据
        settingsCode.setShowTextOnBottom(true);
        //设置边框为不可见
        settingsCode.hasBorder(false);
        BarCodeGenerator generator = new BarCodeGenerator(settingsCode);

        Rectangle2D rect = new Rectangle();
        rect.setRect(point.x, y, barcodeWidth, barcodeHeight);
        //draw
        PdfImage pdfImage1 = PdfImage.fromImage(generator.generateImage());
        page.getCanvas().drawImage(pdfImage1, rect);

        y = y + barcodeHeight + 5;

        //-------创建字体---
        //location
        Point2D.Float pointW = new Point2D.Float();
        pointW.setLocation(45, y);
        //设置字体
        PdfTrueTypeFont font1 = new PdfTrueTypeFont(new Font(&quot;Arial&quot;, Font.BOLD, fontsize), true);
        for (int i = 1; i &lt; 10; i++) {
            Dimension2D tSize = font1.measureString(sku);
            System.out.println(tSize.getWidth());
            if (tSize.getWidth() &gt; (barcodeWidth - 1)) {
                fontsize = fontsize - 1;
                font1 = new PdfTrueTypeFont(new Font(&quot;Aria&quot;, Font.BOLD, fontsize), true);
            } else {
                break;
            }
        }
        //draw
        PdfSolidBrush brush = new PdfSolidBrush(new PdfRGBColor(Color.black));
        page.getCanvas().drawString(sku, font1, brush, pointW);

        //创建BarcodeSettings实例----------------------------------------------
        BarcodeSettings settings = new BarcodeSettings();
        //设置条码类型为QR二维码
        settings.setType(BarCodeType.QR_Code);
        //设置二维码数据
        settings.setData(sku);
        //设置二维码显示数据
        settings.setData2D(null);
        //设置数据类型
        settings.setQRCodeDataMode(QRCodeDataMode.Alpha_Number);
        //设置二维码纠错级别
        settings.setQRCodeECL(QRCodeECL.H);
        settings.setShowText(false);
        settings.setTopMargin(0);
        settings.setLeftMargin(0);
        settings.setRightMargin(0);
        settings.setBottomMargin(0);

        //创建BarCodeGenerator实例
        BarCodeGenerator barCodeGenerator = new BarCodeGenerator(settings);
        //根据settings生成图像数据，保存至BufferedImage实例
        BufferedImage bufferedImage = barCodeGenerator.generateImage();
        //绘制二维码图片到PDF页面指定位置
        PdfImage pdfImage = PdfImage.fromImage(bufferedImage);
        Rectangle2D rect2 = new Rectangle();
        rect2.setRect(barcodeWidth * 1.06, 0, qrWidth, qrWidth);
        page.getCanvas().drawImage(pdfImage, rect2);

        //check
        //--------------
        try {
            String[] dataArr = BarcodeScanner.scan(page.extractImages()[0], BarCodeType.Code_128);
            logger.info(Arrays.toString(dataArr) + &quot;  | &quot; + sku);
            if (dataArr.length == 0) {
                throw new OsjException(&quot;无法读取条码&quot;);
            }
            String nullStr = &quot;null&quot;;
            if (dataArr[0] == null || nullStr.equals(dataArr[0]) || !sku.equals(dataArr[0])) {
                throw new OsjException(&quot;无法读取条码&quot;);
            }
        } catch (Exception e) {
            e.printStackTrace();
        }
        //----------------


        //保存PDF文档
        doc.saveToFile(skuFilePath);
        return skuFilePath;
    }
</code></pre>

      </div>
    </article>
  
    <article class="post">
      <a href="https://2321079146.github.io/mobai.github.io/post/spring-boot-pei-zhi-dong-tai-ding-shi-ren-wu/">
        <h2 class="post-title">Spring Boot 配置动态定时任务</h2>
      </a>
      <div class="post-info">
        <span>
          2022-01-28
        </span>
        <span>
          2 min read
        </span>
        
          <a href="https://2321079146.github.io/mobai.github.io/tag/OiH3qkion/" class="post-tag">
            # springBoot
          </a>
        
      </div>
      
      <div class="post-abstract">
        
      </div>
    </article>
  
    <article class="post">
      <a href="https://2321079146.github.io/mobai.github.io/post/spring-boot-mybatis-plus-shi-xian-dong-tai-duo-shu-ju-yuan/">
        <h2 class="post-title">spring boot + Mybatis Plus 实现动态多数据源</h2>
      </a>
      <div class="post-info">
        <span>
          2022-01-28
        </span>
        <span>
          5 min read
        </span>
        
          <a href="https://2321079146.github.io/mobai.github.io/tag/OiH3qkion/" class="post-tag">
            # springBoot
          </a>
        
      </div>
      
      <div class="post-abstract">
        <h2 id="maven依赖">Maven依赖</h2>
<pre><code class="language-xml">&lt;!-- mybatis-plus --&gt;
&lt;dependency&gt;
	&lt;groupId&gt;com.baomidou&lt;/groupId&gt;
	&lt;artifactId&gt;mybatis-plus-boot-starter&lt;/artifactId&gt;
	&lt;version&gt;${mybatis-plus.version}&lt;/version&gt;
&lt;/dependency&gt;

&lt;!-- 动态数据源 --&gt;
&lt;dependency&gt;
	&lt;groupId&gt;com.baomidou&lt;/groupId&gt;
	&lt;artifactId&gt;dynamic-datasource-spring-boot-starter&lt;/artifactId&gt;
	&lt;version&gt;${dynamic-datasource-spring-boot-starter.version}&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<br/>
<h2 id="springyml配置">Spring.yml配置</h2>
<pre><code class="language-yaml">spring:
  datasource:
    dynamic:
      primary: master #设置默认的数据源或者数据源组,默认值即为master
      strict: false #严格匹配数据源,默认false. true未匹配到指定数据源时抛异常,false使用默认数据源
      datasource:
        master:
          url: jdbc:mysql://xx.xx.xx.xx:3306/dynamic
          username: root
          password: 123456
          driver-class-name: com.mysql.jdbc.Driver # 3.2.0开始支持SPI可省略此配置
</code></pre>
<br/>
<h2 id="读取默认数据源">读取默认数据源</h2>
<pre><code class="language-java">package com.mobai.osj.config.datasource;

import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

/**
 * @author mxc
 * @date 2021-09-30
 * @description 默认数据源配置
 */
@Configuration
public class DataSourceConfig {

    @Value(&quot;${spring.datasource.dynamic.datasource.master.driver-class-name}&quot;)
    private String driverClassName;
    @Value(&quot;${spring.datasource.dynamic.datasource.master.url}&quot;)
    private String url;
    @Value(&quot;${spring.datasource.dynamic.datasource.master.username}&quot;)
    private String username;
    @Value(&quot;${spring.datasource.dynamic.datasource.master.password}&quot;)
    private String password;

    @Bean
    public MysqlDynamicDataSourceProvider mysqlDynamicDataSourceProvider(){
        return new MysqlDynamicDataSourceProvider(driverClassName,url,username,password);
    }
}

</code></pre>
<br/>
<h3 id="程序启动后读取数据库中所有数据源">程序启动后，读取数据库中所有数据源</h3>
<pre><code class="language-java">package com.mobai.osj.config.datasource;

import com.baomidou.dynamic.datasource.provider.AbstractJdbcDataSourceProvider;
import com.baomidou.dynamic.datasource.spring.boot.autoconfigure.DataSourceProperty;

import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.util.HashMap;
import java.util.Map;

/**
 * @author mxc
 * @date 2021-09-30
 * @description 动态数据源配置
 */
public class MysqlDynamicDataSourceProvider extends AbstractJdbcDataSourceProvider {

    public MysqlDynamicDataSourceProvider(String driverClassName, String url, String username, String password) {
        super(driverClassName, url, username, password);
    }

    @Override
    protected Map&lt;String, DataSourceProperty&gt; executeStmt(Statement statement) throws SQLException {
        ResultSet rs = statement.executeQuery(&quot;select * from sys_data_source&quot;);
        Map&lt;String, DataSourceProperty&gt; map = new HashMap&lt;&gt;(4);

        // 从数据库中获取信息
        while(rs.next()){
            String code = rs.getString(&quot;code&quot;);
            String url = rs.getString(&quot;db_url&quot;);
            String username = rs.getString(&quot;db_username&quot;);
            String password = rs.getString(&quot;db_password&quot;);
            String key = rs.getString(&quot;db_name&quot;);
            String driverClassName = rs.getString(&quot;db_driver&quot;);

            DataSourceProperty dataSourceProperty = new DataSourceProperty();
            dataSourceProperty.setPoolName(code);
            dataSourceProperty.setDriverClassName(driverClassName);
            dataSourceProperty.setUrl(url);
            dataSourceProperty.setUsername(username);
            dataSourceProperty.setPassword(password);

            map.put(key,dataSourceProperty);
        }
        return map;
    }
}

</code></pre>
<br/>
<h3 id="ds数据源名称指定数据源处理业务">@DS(数据源名称)指定数据源，处理业务</h3>
<pre><code class="language-java">package com.mobai.osj.system.service.impl;

import com.baomidou.dynamic.datasource.annotation.DS;
import com.mobai.osj.system.service.BusinessService;
import lombok.AllArgsConstructor;
import org.springframework.stereotype.Service;

import javax.sql.DataSource;
import java.sql.Connection;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;

/**
 * @author mxc
 * @date 2022-01-06
 * @description 跨服务实现层
 */
@AllArgsConstructor
@Service
public class BusinessServiceImpl implements BusinessService {

    final private DataSource datasource;

    @DS(&quot;OSJ_PRO&quot;)
    @Override
    public ResultSet selectForJapanBigPromotion(String sql) throws SQLException {
        Connection connection = datasource.getConnection();
        Statement statement = connection.prepareStatement(sql);
        return statement.executeQuery(sql);
    }
}

</code></pre>
<br/>
<h3 id="数据库数据源配置">数据库数据源配置</h3>
<pre><code class="language-sql">CREATE TABLE `sys_data_source` (
  `id` varchar(36) NOT NULL,
  `code` varchar(100) DEFAULT NULL COMMENT '数据源编码',
  `name` varchar(100) DEFAULT NULL COMMENT '数据源名称',
  `remark` varchar(200) DEFAULT NULL COMMENT '备注',
  `db_type` varchar(10) DEFAULT NULL COMMENT '数据库类型',
  `db_driver` varchar(100) DEFAULT NULL COMMENT '驱动类',
  `db_url` varchar(500) DEFAULT NULL COMMENT '数据源地址',
  `db_name` varchar(100) DEFAULT NULL COMMENT '数据库名称',
  `db_username` varchar(100) DEFAULT NULL COMMENT '用户名',
  `db_password` varchar(100) DEFAULT NULL COMMENT '密码',
  `create_by` varchar(50) DEFAULT NULL COMMENT '创建人',
  `create_time` datetime DEFAULT NULL COMMENT '创建日期',
  `update_by` varchar(50) DEFAULT NULL COMMENT '更新人',
  `update_time` datetime DEFAULT NULL COMMENT '更新日期',
  `sys_org_code` varchar(64) DEFAULT NULL COMMENT '所属部门',
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE KEY `sys_data_source_code_uni` (`code`) USING BTREE,
  UNIQUE KEY `uk_sdc_rule_code` (`code`) USING BTREE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 ROW_FORMAT=DYNAMIC
</code></pre>

      </div>
    </article>
  
    <article class="post">
      <a href="https://2321079146.github.io/mobai.github.io/post/ce-shi-bai-du-kong-jian-shi-fou-ke-yong/">
        <h2 class="post-title">并发编程（一）：线程池</h2>
      </a>
      <div class="post-info">
        <span>
          2022-01-20
        </span>
        <span>
          10 min read
        </span>
        
          <a href="https://2321079146.github.io/mobai.github.io/tag/VshJslI3X/" class="post-tag">
            # 多线程
          </a>
        
      </div>
      
      <div class="post-abstract">
        
      </div>
    </article>
  
</div>

    
        <div class="pagination-container">
  
  
</div>

    
        <div class="site-footer">
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>
  <a class="rss" href="https://2321079146.github.io/mobai.github.io//atom.xml" target="_blank">
    <i class="ri-rss-line"></i> RSS
  </a>
</div>

      </div>
    </div>
  </body>
</html>
